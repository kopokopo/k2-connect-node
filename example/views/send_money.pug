extends layout

block content
  br
  p !{message}
  .container
    .title.h3 Send Money
    br
    form(action="/sendmoney", method="post", id="sendMoneyForm")
      #sourceIdentifierField
        .form-group.row
          label.col-sm-2.col-form-label(for="source_identifier") Source Identifier
          .col-sm-7
            input.form-control(name="source_identifier", type="text", placeholder="Enter Source Identifier")
            small.form-text.text-muted
              | Till number or null/blank for available balance

      .form-group.row
        label.col-sm-2.col-form-label(for="destination_type") Destination Type
        .col-sm-7
          select.form-control(name="destination_type", id="destinationType")
            option(value="my_accounts") My Accounts
            option(value="merchant_wallet") Merchant Wallet
            option(value="merchant_bank_account") Merchant Bank Account
            option(value="mobile_wallet") Mobile Wallet
            option(value="bank_account") Bank Account
            option(value="till") Till
            option(value="paybill") Paybill

      //- Mobile Wallet Fields
      .destination-fields#mobile_walletFields(style="display:none")
        .form-group.row
          label.col-sm-2.col-form-label(for="phone_number") Phone Number
          .col-sm-7
            input.form-control(name="phone_number", type="text", placeholder="Enter Phone Number")
        .form-group.row
          label.col-sm-2.col-form-label(for="network") Network
          .col-sm-7
            select.form-control(name="network")
              option(value="Safaricom") Safaricom

      //- Merchant Wallet & Merchant Bank Account Fields
      .destination-fields#merchantFields(style="display:none")
        .form-group.row
          label.col-sm-2.col-form-label(for="reference") Reference
          .col-sm-7
            input.form-control(name="reference", type="text", placeholder="Enter Reference")

      //- Bank Account Fields
      .destination-fields#bank_accountFields(style="display:none")
        .form-group.row
          label.col-sm-2.col-form-label(for="bank_branch_ref") Bank Branch Reference
          .col-sm-7
            input.form-control(name="bank_branch_ref", type="text", placeholder="Enter Bank Branch Reference")
        .form-group.row
          label.col-sm-2.col-form-label(for="account_name") Account Name
          .col-sm-7
            input.form-control(name="account_name", type="text", placeholder="Enter Account Name")
        .form-group.row
          label.col-sm-2.col-form-label(for="account_number") Account Number
          .col-sm-7
            input.form-control(name="account_number", type="text", placeholder="Enter Account Number")

      //- Till Fields
      .destination-fields#tillFields(style="display:none")
        .form-group.row
          label.col-sm-2.col-form-label(for="till_number") Till Number
          .col-sm-7
            input.form-control(name="till_number", type="text", placeholder="Enter Till Number")

      //- Paybill Fields
      .destination-fields#paybillFields(style="display:none")
        .form-group.row
          label.col-sm-2.col-form-label(for="paybill_number") Paybill Number
          .col-sm-7
            input.form-control(name="paybill_number", type="text", placeholder="Enter Paybill Number")
        .form-group.row
          label.col-sm-2.col-form-label(for="paybill_account_number") Paybill Account Number
          .col-sm-7
            input.form-control(name="paybill_account_number", type="text", placeholder="Enter Paybill Account Number")

      //- Common Fields
      .destination-fields#commonFields
        .form-group.row
          label.col-sm-2.col-form-label(for="amount") Amount
          .col-sm-7
            input.form-control(name="amount", type="number", placeholder="Enter Amount" required)
        .form-group.row
          label.col-sm-2.col-form-label(for="description") Description
          .col-sm-7
            input.form-control(name="description", type="text", placeholder="Enter Description" required)

      br
      .form-group.row
        .col-sm-7
          button.btn.btn-primary(type="submit") Send Money

  script.
    document.addEventListener("DOMContentLoaded", function () {
      const select = document.getElementById("destinationType");
      const sections = {
        mobile_wallet: document.getElementById("mobile_walletFields"),
        merchant_wallet: document.getElementById("merchantFields"),
        merchant_bank_account: document.getElementById("merchantFields"),
        bank_account: document.getElementById("bank_accountFields"),
        till: document.getElementById("tillFields"),
        paybill: document.getElementById("paybillFields")
      };
      const commonFields = document.getElementById("commonFields");
      const sourceIdentifierField = document.getElementById("sourceIdentifierField");
      const sourceIdentifierInput = sourceIdentifierField.querySelector('input[name="source_identifier"]');

      function toggleFields() {
        const value = select.value;
        for (let key in sections) {
          sections[key].style.display = "none";
        }
        if (sections[value]) {
          sections[value].style.display = "block";
        }
        if (value === "my_accounts") {
          commonFields.style.display = "none";
          sourceIdentifierField.style.display = "none";
        } else {
          commonFields.style.display = "block";
          sourceIdentifierField.style.display = "block";
        }
      }

      select.addEventListener("change", toggleFields);
      toggleFields();
    });
